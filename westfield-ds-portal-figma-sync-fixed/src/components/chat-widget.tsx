"use client";import React from "react";import Link from "next/link";import { Button } from "@/components/ui";type Citation = { label: string; href: string };type Msg = { role: "user" | "assistant"; content: string; citations?: Citation[] };export function ChatWidget() {const [open, setOpen] = React.useState(false);const [q, setQ] = React.useState("");const [loading, setLoading] = React.useState(false);const [msgs, setMsgs] = React.useState<Msg[]>([{role: "assistant",content: "Ask about brand guidelines or components. I’ll cite the portal pages when possible.",citations: [{ label: "Brand → Colors", href: "/brand/colors" },{ label: "Components", href: "/components" },],},]);// optional: persist open/closed stateReact.useEffect(() => {const saved = window.localStorage.getItem("ds_chat_open");if (saved) setOpen(saved === "1");}, []);React.useEffect(() => {window.localStorage.setItem("ds_chat_open", open ? "1" : "0");}, [open]);async function send() {const question = q.trim();if (!question || loading) return;    setMsgs((m) => [...m, { role: "user", content: question }]);    setQ("");    setLoading(true);    try {      const res = await fetch("/api/ask", {        method: "POST",        headers: { "content-type": "application/json" },        body: JSON.stringify({ question }),      });      const data = await res.json();      setMsgs((m) => [        ...m,        {          role: "assistant",          content: data.answer ?? "No answer.",          citations: data.citations ?? [],        },      ]);    } finally {      setLoading(false);    }}return (<divstyle={{position: "fixed",right: 16,bottom: 16,zIndex: 50,width: open ? 360 : "auto",}}aria-live="polite">{!open ? (<Button variant="primary" onClick={() => setOpen(true)} aria-label="Open chat assistant">Chat</Button>) : (<div className="card" style={{ overflow: "hidden" }}><divstyle={{display: "flex",alignItems: "center",justifyContent: "space-between",gap: 10,padding: 12,borderBottom: "1px solid var(--border)",background: "white",}}><div style={{ fontWeight: 800 }}>Assistant</div><div style={{ display: "flex", gap: 8 }}><Button onClick={() => setOpen(false)} aria-label="Collapse chat">Collapse</Button></div></div>          <div            style={{              padding: 12,              height: 360,              overflow: "auto",              display: "grid",              gap: 10,              background: "var(--muted)",            }}          >            {msgs.map((m, idx) => (              <div                key={idx}                className="card"                style={{                  padding: 10,                  background: m.role === "user" ? "white" : "var(--muted)",                }}              >                <div style={{ fontWeight: 700, marginBottom: 6 }}>                  {m.role === "user" ? "You" : "Assistant"}                </div>                <div className="small" style={{ whiteSpace: "pre-wrap" }}>                  {m.content}                </div>                {m.citations?.length ? (                  <div style={{ marginTop: 10, display: "flex", gap: 8, flexWrap: "wrap" }}>                    {m.citations.map((c) => (                      <Link key={c.href} href={c.href} className="badge">                        {c.label}                      </Link>                    ))}                  </div>                ) : null}              </div>            ))}          </div>          <div style={{ padding: 12, borderTop: "1px solid var(--border)", background: "white" }}>            <div style={{ display: "flex", gap: 8 }}>              <input                value={q}                onChange={(e) => setQ(e.target.value)}                placeholder='e.g., "When do I use primary color?"'                className="card"                style={{                  padding: 10,                  flex: 1,                  borderRadius: 10,                  border: "1px solid var(--border)",                }}                onKeyDown={(e) => {                  if (e.key === "Enter") send();                }}              />              <Button variant="primary" disabled={loading} onClick={send}>                {loading ? "…" : "Send"}              </Button>            </div>          </div>        </div>      )}    </div>);}